import{r as o,b as L,j as s,a as R,g as K,c as Q,d as v,P as M,s as V,e as I,f as W,h as X,u as A}from"./index-By3rKhgF.js";const Y=()=>{const[x,k]=o.useState([]),[d,E]=o.useState([]),[u,F]=o.useState([]),[P,D]=o.useState(!0),[c,m]=o.useState(null),[g,p]=o.useState(1),h=5,[j,b]=o.useState([]),[f,S]=o.useState({}),[w,C]=o.useState(!1),y=M,t=L.currentUser?L.currentUser.uid:null,l=async()=>{try{D(!0),console.log("Fetching data...");const[e,a,n]=await Promise.all([R.get("https://genshin.jmp.blue/boss/weekly-boss/all?lang=en"),R.get("https://genshin.jmp.blue/artifacts/all?lang=en"),R.get("https://genshin.jmp.blue/characters/all?lang=en")]);console.log("Fetched bosses:",e.data),console.log("Fetched artifacts:",a.data),console.log("Fetched characters:",n.data),k(e.data.map(r=>({id:r.name,name:r.name,portrait:`https://genshin.jmp.blue/boss/weekly-boss/${r.name.replace(/ /g,"-").toLowerCase()}/portrait`}))),E(a.data.map(r=>({id:r.id,name:r.name,portrait:`https://genshin.jmp.blue/artifacts/${r.id}/circlet-of-logos`}))),F(n.data.map(r=>({id:r.id,name:r.name,portrait:`https://genshin.jmp.blue/characters/${r.id}/card`})))}catch(e){console.error("Error fetching data:",e),m(`Error fetching data: ${e.message}`)}finally{D(!1)}},i=e=>{if(f[e.id])return console.log(`Image URL for ${e.id} already loaded.`),f[e.id];const a=e.portrait||y;console.log(`Loading image for ${e.id} from ${a}`);const n=new Image;return n.onload=()=>{S(r=>({...r,[e.id]:a})),localStorage.setItem(e.id,a)},n.onerror=()=>{S(r=>({...r,[e.id]:y})),localStorage.setItem(e.id,y)},n.src=a,a},U=async()=>{if(t)try{console.log("Fetching favorites from Firestore...");const e=await K(Q(v,"favorites",t,"items")),a=[];e.forEach(n=>{const r=n.data();a.push({id:n.id,...r})}),console.log("Favorites fetched:",a),b(a)}catch(e){console.error("Error fetching favorites:",e),m("Error fetching favorites")}},N=async e=>{if(t)try{console.log(`Saving favorite: ${e.id}`),await V(I(v,"favorites",t,"items",e.id),e),b(a=>[...a,e])}catch(a){console.error("Error saving favorite:",a),m("Error saving favorite")}},O=async e=>{if(t)try{console.log(`Removing favorite: ${e.id}`),await W(I(v,"favorites",t,"items",e.id)),b(a=>a.filter(n=>n.id!==e.id))}catch(a){console.error("Error removing favorite:",a),m("Error removing favorite")}};o.useEffect(()=>{t&&(l(),U())},[t]);const $=g*h,q=$-h,B=[...x,...d,...u].slice(q,$),T=g===1,z=g*h>=[...x,...d,...u].length,G=e=>{console.log(`Adding/removing from favorites: ${e.id}`),j.some(n=>n.id===e.id)?O(e):N(e)},H=()=>{C(!0)},J=()=>{C(!1)};return P?s.jsx("div",{children:"Loading..."}):c?s.jsx("div",{children:c}):s.jsxs("div",{className:"api-pagination",children:[s.jsxs("div",{className:"favorites-list",children:[s.jsx("h2",{children:"Favorites"}),j.map(e=>s.jsxs("div",{className:"favorite-card",children:[s.jsx("img",{src:i(e),alt:e.name||"Unnamed",className:"favorite-image"}),s.jsx("p",{children:e.name})]},e.id))]}),s.jsx("button",{onClick:H,className:"edit-favorites-btn",children:"Edit Favorites"}),w&&s.jsx("div",{className:"modal",children:s.jsxs("div",{className:"modal-content",children:[s.jsx("h2",{children:"Items"}),s.jsxs("div",{className:"item-list",children:[B.length===0&&s.jsx("div",{children:"No items to display."}),B.map(e=>s.jsxs("div",{className:"card",children:[s.jsx("img",{src:i(e),alt:e.name||"Unnamed",className:"card-image"}),s.jsx("h3",{className:"card-title",children:e.name}),s.jsx("button",{onClick:()=>G(e),className:"add-to-fav-btn",children:"Add to Fav"})]},e.id))]}),s.jsxs("div",{className:"pagination",children:[s.jsx("button",{onClick:()=>p(e=>e-1),disabled:T,children:"Previous"}),s.jsxs("span",{children:["Page ",g," of ",Math.ceil([...x,...d,...u].length/h)]}),s.jsx("button",{onClick:()=>p(e=>e+1),disabled:z,children:"Next"})]}),s.jsx("button",{onClick:J,className:"close-modal-btn",children:"Close"})]})})]})},_=()=>{const[x,k]=o.useState(()=>{const t=localStorage.getItem("profileImage");return t||M}),[d,E]=o.useState(""),[u,F]=o.useState(""),[P,D]=o.useState(""),[c,m]=o.useState(""),[g,p]=o.useState(!1),[h,j]=o.useState(!1),[b,f]=o.useState(!0),S=o.useRef(null);o.useEffect(()=>{(async()=>{f(!0);const l=L.currentUser;if(!l){console.warn("No authenticated user found"),f(!1);return}try{const i=I(v,"users",l.uid),U=await X(i);if(!U.exists()){console.warn("User document does not exist in Firestore"),f(!1);return}const N=U.data();D(N.username||"Anonymous"),E(N.bio||""),F(N.slogan||""),m(l.uid)}catch(i){console.error("Error fetching user data:",i)}finally{f(!1)}})()},[]);const w=t=>{const l=t.target.files[0];if(!l){console.error("No file selected");return}const i=URL.createObjectURL(l);localStorage.setItem("profileImage",i),k(i)},C=()=>{if(c){const t=I(v,"users",c);A(t,{bio:d})}p(!1)},y=()=>{if(c){const t=I(v,"users",c);A(t,{slogan:u})}j(!1)};return b?s.jsx("div",{children:"Loading..."}):s.jsxs("div",{className:"user-profile-container",children:[s.jsxs("div",{className:"profile-header",children:[s.jsx("img",{className:"profile-image",src:x,alt:"Profile",onClick:()=>S.current.click()}),s.jsx("input",{type:"file",ref:S,style:{display:"none"},accept:"image/*",onChange:w})]}),s.jsx("h2",{children:P}),s.jsxs("p",{children:["ID: ",c]}),s.jsxs("div",{onClick:()=>p(!0),children:[s.jsx("div",{className:"section-title",children:"Bio:"}),g?s.jsxs("div",{children:[s.jsx("textarea",{className:"editable-textarea",value:d,onChange:t=>E(t.target.value),placeholder:"Enter your bio",style:{height:g?"auto":"30px"}}),s.jsx("button",{className:"save-button",onClick:C,children:"Save Bio"})]}):s.jsx("p",{children:d||"Click here to add your bio"})]}),s.jsxs("div",{onClick:()=>j(!0),children:[s.jsx("div",{className:"section-title",children:"Slogan:"}),h?s.jsxs("div",{children:[s.jsx("input",{className:"editable-input",type:"text",value:u,onChange:t=>F(t.target.value),placeholder:"Enter your slogan",style:{width:h?"auto":"100%"}}),s.jsx("button",{className:"save-button",onClick:y,children:"Save Slogan"})]}):s.jsx("p",{children:u||"Click here to add your slogan"})]}),s.jsx(Y,{})]})};export{_ as default};
